<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clima â€” Mar del Plata</title>
<style>
:root {
  --bg:#0f1116; 
  --card:#14171b; 
  --muted:#98a1ad; 
  --accent:#6ea8ff;
}
body {
  margin:0; 
  font-family:Inter,system-ui,Arial,sans-serif; 
  background:var(--bg); 
  color:#eef2f7;
}
.wrap { max-width:1100px; margin:18px auto; padding:12px; }
header { display:flex; justify-content:space-between; align-items:center; gap:12px; }
header h1 { margin:0; color:var(--accent); font-size:1.05rem; }
.layout { display:grid; grid-template-columns:1fr; gap:16px; margin-top:16px; }
@media(min-width:920px){ .layout{ grid-template-columns:1fr 420px; } }
.card { background:var(--card); border-radius:12px; padding:14px; box-shadow:0 6px 22px rgba(0,0,0,0.5); }
.controls { display:flex; gap:8px; align-items:center; }
select,input,button { background:transparent; border:1px solid rgba(255,255,255,0.06); color:#fff; padding:8px 10px; border-radius:8px; }
button { background:var(--accent); color:#042039; border:none; cursor:pointer; }
.row { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
.icon-large { width:96px; height:96px; border-radius:50%; background:var(--accent); display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:2rem; }
.temp { font-size:2.4rem; font-weight:700; }
.desc { color:var(--muted); text-transform:capitalize; }
.meta { font-size:0.9rem; color:var(--muted); margin-top:8px; }
.forecast { display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
.fday { background:rgba(255,255,255,0.02); padding:8px; border-radius:8px; width:110px; text-align:center; }
iframe { width:100%; height:320px; border:0; border-radius:8px; }
.small { font-size:0.85rem; color:var(--muted); }
.grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
footer { margin-top:14px; color:var(--muted); font-size:0.85rem; text-align:center; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Clima â€” Mar del Plata</h1>
      <div class="small">Datos actuales, humedad, presiÃ³n, viento, radar</div>
    </div>
    <div class="controls">
      <button id="btnRefresh">Actualizar</button>
      <a href="https://www.smn.gob.ar" target="_blank" style="text-decoration:none">
        <button>Ver SMN (oficial)</button>
      </a>
    </div>
  </header>

  <div class="layout">
    <!-- IZQUIERDA: CLIMA -->
    <main class="card" id="mainCard">
      <section id="current" aria-live="polite">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
          <div>
            <div id="cityName" style="font-weight:700;font-size:1.2rem">Mar del Plata, AR</div>
            <div id="timeStamp" class="small">Ãšltima actualizaciÃ³n: --</div>
          </div>
          <div class="row">
            <div id="weatherIcon" class="icon-large">â˜€</div>
            <div style="text-align:right">
              <div class="temp" id="tempVal">--Â°C</div>
              <div class="desc" id="descVal">--</div>
              <div class="meta" id="metaVal">Hum: -- Â· Pres: -- hPa Â· Viento: -- m/s</div>
            </div>
          </div>
        </div>

        <div style="margin-top:12px">
          <strong>Detalles</strong>
          <div class="grid-2" style="margin-top:8px">
            <div class="small card" style="padding:10px">SensaciÃ³n tÃ©rmica: <span id="feels">--Â°C</span></div>
            <div class="small card" style="padding:10px">Visibilidad: <span id="vis">-- km</span></div>
            <div class="small card" style="padding:10px">Prob. lluvia (3h): <span id="pop">-- %</span></div>
            <div class="small card" style="padding:10px">Nubosidad: <span id="clouds">-- %</span></div>
          </div>
        </div>

        <div class="forecast" id="forecast"></div>
      </section>
    </main>

    <!-- DERECHA: RADAR -->
    <aside>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Radar (RainViewer)</strong><div class="small">centrado en Mar del Plata</div></div>
          <div class="small">Actualiza 5 min</div>
        </div>
        <iframe id="radarFrame"
          src="https://www.rainviewer.com/map.html?lat=-38.00&lon=-57.55&zoom=8&overlay=radar&opacity=80&animate=true"
          title="Radar Mar del Plata"></iframe>
      </div>
    </aside>
  </div>

  <footer>
    PÃ¡gina de prueba â€” API: OpenWeatherMap (usa tu clave). Radar: RainViewer. Solo HTML+CSS+JS bÃ¡sico.
  </footer>
</div>

<script>
const API_KEY = "ed3ff78da52f4d08960210312250911"; // <-- API Key de WeatherAPI
const LAT = -38.0055;
const LON = -57.5426;

// DOM refs
const cityNameEl = document.getElementById('cityName');
const timeStampEl = document.getElementById('timeStamp');
const tempValEl = document.getElementById('tempVal');
const descValEl = document.getElementById('descVal');
const metaValEl = document.getElementById('metaVal');
const iconEl = document.getElementById('weatherIcon');
const forecastEl = document.getElementById('forecast');
const feelsEl = document.getElementById('feels');
const visEl = document.getElementById('vis');
const popEl = document.getElementById('pop');
const cloudsEl = document.getElementById('clouds');
const radarFrame = document.getElementById('radarFrame');
const btnRefresh = document.getElementById('btnRefresh');

// --- FETCH datos actuales y pronÃ³stico 7 dÃ­as ---
async function fetchClima(){
  try{
    const url = `https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${LAT},${LON}&days=7&aqi=no&alerts=no&lang=es`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('Error al obtener clima');
    const data = await res.json();
    renderNow(data);
    renderForecast(data.forecast.forecastday);
  } catch(e){
    console.error(e);
    cityNameEl.innerText='Mar del Plata (sin datos)';
    tempValEl.innerText='--Â°C';
    descValEl.innerText='No disponible';
    metaValEl.innerText='';
    forecastEl.innerHTML='<div class="small">Error al obtener datos</div>';
  }
}

// --- Render actual ---
function renderNow(data){
  cityNameEl.innerText = data.location.name + ', ' + data.location.country;
  timeStampEl.innerText = 'Ãšltima actualizaciÃ³n: ' + data.current.last_updated;
  tempValEl.innerText = data.current.temp_c + 'Â°C';
  descValEl.innerText = data.current.condition.text;
  metaValEl.innerText = `Hum: ${data.current.humidity}% Â· Pres: ${data.current.pressure_mb} hPa Â· Viento: ${data.current.wind_kph} km/h`;
  feelsEl.innerText = data.current.feelslike_c + 'Â°C';
  visEl.innerText = data.current.vis_km + ' km';
  cloudsEl.innerText = data.current.cloud + ' %';
  popEl.innerText = data.forecast?.forecastday[0]?.day?.daily_chance_of_rain ?? '--';
  iconEl.innerText = getIcon(data.current.condition.text);
}

// --- Render forecast 7 dÃ­as ---
function renderForecast(days){
  forecastEl.innerHTML='';
  days.forEach(d=>{
    const div = document.createElement('div');
    div.className='fday';
    const date = new Date(d.date);
    const weekday = date.toLocaleDateString('es-AR',{weekday:'long'});
    div.innerHTML = `<div style="font-weight:700;text-transform:capitalize">${weekday}</div>
                     <div style="margin-top:6px">${getIcon(d.day.condition.text)}</div>
                     <div style="margin-top:6px">${d.day.maxtemp_c}Â° / ${d.day.mintemp_c}Â°</div>`;
    forecastEl.appendChild(div);
  });
}

// --- Icono simple cÃ­rculo con inicial del clima ---
function getIcon(text){
  const mapping = {
    'Sunny':'â˜€','Clear':'â˜€','Partly cloudy':'â›…','Cloudy':'â˜','Overcast':'â˜','Rain':'ðŸŒ§','Light rain':'ðŸŒ¦','Snow':'â„','Mist':'ðŸŒ«'
  };
  return mapping[text]||'â˜€';
}

// --- BotÃ³n refresh ---
btnRefresh.addEventListener('click', fetchClima);

// --- Inicializar ---
fetchClima();
setInterval(fetchClima, 10*60*1000); // clima cada 10 min
setInterval(()=>{ radarFrame.src = radarFrame.src.split('&t=')[0]+'&t='+Date.now(); }, 5*60*1000); // radar 5 min

</script>
</body>
</html>
